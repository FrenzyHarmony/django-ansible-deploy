---

- name: import public variable file
  include_vars: "public_key.yml"
  no_log: False

- name: import secret variable file
  include_vars: secret_key.yml
  no_log: False

- name: Create directory for ssh keys
  file:
    name: "/home/{{ system_user }}/.ssh"
    owner: "{{ system_user }}"
    group: "{{ system_group }}"
    state: directory
  no_log: False

- name: copy deployment private key
  copy:
    content: "{{ private_key_content }}"
    dest: "/home/{{ system_user }}/.ssh/id_rsa"
    owner: "{{ system_user }}"
    group: "{{ system_group }}"
    mode: 0600
  no_log: False

- name: copy deployment public key
  copy:
    content: "{{ public_key_content }}"
    dest: "/home/{{ system_user }}/.ssh/id_rsa.pub"
    owner: "{{ system_user }}"
    group: "{{ system_group }}"
    mode: 0600
  no_log: False


- include: setup_git_repo.yml
  tags: deploy

- include: install_requirements.yml
  tags: deploy

- include: setup_django_app.yml
  sudo: yes
  sudo_user: "{{ system_user }}"
  notify: touch reload
  tags: deploy

